# [现在处理器性能分析及优化(简述)](https://github.com/Jared-ZDC/Jared-ZDC.github.io/issues/3)

一直以来，工程师都有一个观念：“性能为王”，以前是，现在是，以后更是。

根据[《Data Never Sleeps 5.0》](https://www.domo.com/learn/data-neversleeps-5?aid=ogsm072517_1&sf100871281=1)调查研究，世界上每天产生2.5万亿字节的数据，并且保持着每年25%的速度递增。在我们如今的社会生活中，信息产生的来源越来越多，信息交换的速度越来越快，推动了对更快软件（SW）和更快硬件（HW）的需求。简而言之，数据增长不仅对计算能力提出了更高的需求，而且对存储和网络系统也提出了更高需求。

在PC时代，开发人员通常直接在操作系统之上编程，有时候还不可避免的需要控制软件跟硬件的协调情况。随着世界进入云时代，软件堆栈变得更深更复杂。通过对底层硬件的高度抽象，大多数开发人员往往无需对于实际硬件的把控，直接基于分布式、虚拟化、微服务以及更高层次的开发环境进行开发，效率极大提高的同时，却也带来了消极的一面，现代应用程序对于硬件的亲和性逐渐降低。

当然这也幸亏于摩尔定律的有效性，软件程序员几十年来一直“轻松愉快”。过去，一些软件供应商更愿意等待新一代硬件来加快应用程序的速度，而不花费人力资源来改进代码。但是，花无百日红，在如今摩尔定律正在逐渐失效，通过查看图1，我们可以看到单线程性能增长正在放缓，想要再通过简单的ScalUp的方式提高性能，收益越来越小。

![Figure 1: 40 Years of Microprocessor Trend Data. © Image by K. Rupp via karlrupp.net](https://user-images.githubusercontent.com/17999499/160777801-b618dc94-0548-4ea7-b796-a752302d37e8.png "Figure 1: 40 Years of Microprocessor Trend Data. © Image by K. Rupp via karlrupp.net")

因此当硬件性能提升不再提供显著的收益时，我们必须开始更多地关注代码运行的速度，分析软硬件运行方式，协同能力，并且进行优化。
>“Software today is massively inefficient; it’s become prime time again for software programmers to get really good at optimization.” - Marc Andreessen, the US entrepreneur and investor (a16z Podcast, 2020)

>***个人经验**：在英特尔工作期间，我经常听到这样的故事：当英特尔客户应用程序运行性能不达标时，他们会立即下意识地开始指责英特尔的CPU性能不足。但是，当英特尔派遣我们的性能优化专家与他们合作并帮助他们改进应用程序时，客户的程序性能立刻提高5到10倍*

>***笔者经验**：笔者曾经也处理过类似的案例，在华为鲲鹏处理器上运行的一个加密货币的业务，仅仅因为优化了一下软件的算法指令，性能直接提升20倍以上。由此可见，很多时候，并非处理器性能不达标，而是软硬协同能力不足，并没有充分发挥处理器的能力*

优化应用性能是一件具有挑战性的工作，通常需要大量的努力，但希望这本书能够给你提供一定的帮助！

## 为什么需要性能优化

现代CPU核心数量逐年递增。从2019年底开始，市场上已经有了高达100个核心的处理器（目前估计可以到200个核心以上了），这是非常令人兴奋的，但这并不意味着我们不必再关心性能了，甚至于更多的核心有可能导致应用性能反而出现下降的可能。

一般来说，通用多线程应用程序的性能并不总是随我们分配给任务的CPU核心数量线性扩展。了解发生这种情况的原因以及修复这种情况的可能方法对于产品性能的未来增长至关重要。如果不对应用进行适当的性能分析和调整，这将会导致大量的性能和资金浪费，并扼杀项目产品。

根据【Leiserson等人。,2020】，至少在短期内，大多数应用程序的大部分性能提升将来自软件堆栈。遗憾的是，应用程序在默认情况下无法获得最佳性能。第条【莱瑟森等人。,2020]还提供了一个很好的示例，说明了在源代码级别上可以实现的性能改进的潜力。表1总结了性能工程的加速，该程序将两个4096×4096矩阵相乘。应用多重优化的最终结果是程序运行速度快了60,000倍以上。提供这个例子的原因并不是为了挑Python或Java（它们是伟大的语言），而是为了打破软件默认具有“足够好”性能的信念。

